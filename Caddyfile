# /Caddyfile
{
    log {
        # Log to stderr so it appears in Railway logs
        output stderr
        # Use JSON format for clarity, include the variable value
        format json { # <<< Start JSON format definition
            # Define JSON fields directly using key = value pairs
            # Standard log fields using placeholders:
            level = "{log.level}"
            ts = "{log.time}" # Using standard Caddy time format (can customize if needed)
            msg = "{log.msg}"
            request = "{log.request>method} {log.request>uri}"
            status = "{log.response>status}"
            size = "{log.response>size}"
            duration = "{log.duration}"
            remote_ip = "{log.request>remote_ip}"
            proto = "{log.request>proto}"

            # Your custom field with the environment variable:
            private_host_var = "{env.JUPYTER_IPFS_PRIVATE_HOST}"

        } # <<< End JSON format definition
        level INFO # Or DEBUG for more verbosity
    }
}

# Define the main site block listening on the port Railway provides ($PORT)
http://:{$PORT} {
	# Reverse proxy all requests to the internal jupyter-ipfs service.
	# Use the environment variable injected by Railway.
	# Port 4001 is the internal IPFS WS port.
	# --- MODIFIED LINE: Removed http:// ---
	reverse_proxy {env.JUPYTER_IPFS_PRIVATE_HOST}:4001
	# --- END MODIFIED LINE ---
}
